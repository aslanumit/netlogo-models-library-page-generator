<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agentset Efficiency</title>
    <link rel="stylesheet" href="../../../styles.css" />
  </head>
  <body>
    <main class="model-page">
      <a class="back-link" href="../../../index.html">← Back to list</a>
      <div class="model-card">
        <div class="model-header">
          <h1>Agentset Efficiency</h1>
          <a class="run-button" href="https://netlogoweb.org/launch#https://netlogoweb.org/assets/modelslib/IABM%20Textbook/chapter%205/Agentset%20Efficiency.nlogox" target="_blank" rel="noopener">Run on NetLogoWeb</a>
        </div>
        <img src="../../../../models/IABM Textbook/chapter 5/Agentset Efficiency.png" alt="Screenshot of Agentset Efficiency" />
        <div class="model-info"><h2>ACKNOWLEDGMENT</h2>
<p>This model is from Chapter Five of the book "Introduction to Agent-Based Modeling: Modeling Natural, Social and Engineered Complex Systems with NetLogo", by Uri Wilensky &amp; William Rand.</p>
<ul>
<li>Wilensky, U. &amp; Rand, W. (2015). Introduction to Agent-Based Modeling: Modeling Natural, Social and Engineered Complex Systems with NetLogo. Cambridge, MA. MIT Press.</li>
</ul>
<p>This model is in the IABM Textbook folder of the NetLogo Models Library. The model, as well as any updates to the model, can also be found on the textbook website: http://www.intro-to-abm.com/.</p>
<h2>UPDATES TO THE MODEL SINCE TEXTBOOK PUBLICATION</h2>
<p>The code for this model differs from the code in the textbook. The code here is the most up to date version. The code for the agentset efficiency model in the book (pages 219-222) should be replaced with the code in this model.</p>
<h2>WHAT IS IT?</h2>
<p>This model addresses a couple of concerns that can arise when using agentsets, in particular when filtering them using the "<code>with</code>" primitive. The first of these concerns has to do with efficiency: it is best to avoid building the same agentset multiple times. The second concern has to do with the timing of side effects: rebuilding an agentset using the same condition can lead to different results if the state of the agents has changed in the meanwhile.</p>
<h2>HOW IT WORKS</h2>
<p>SETUP creates a world where roughly half the patches are red and half the patches are green.</p>
<p>GO-1 sets the labels of red patches to a small random number (0-4) and the labels of green patches to a larger random number (5-9). It only sets the label of each patch if there are at least 5 patches of the other color.</p>
<p>GO-2 is a more efficient implementation of GO-1, as it only computes the <code>red-patches</code> and <code>green-patches</code> agentsets once instead of recomputing the green patches again for each red patch and recomputing the red patches again for each green patch.</p>
<p>GO-3 is written as if the intention is to swap green patches with red patches. However, because of a bug in the code, it first changes all the red patches to green patches, and then doesn't change any patches to red. GO-3 has unexpected behavior and is given here as an example of the potential pitfalls of changing agentsets on the fly.</p>
<p>GO-4 is similar to GO-3, but it computes the <code>red-patches</code> and <code>green-patches</code> agentsets <em>before</em> changing them, which avoids the problem we had with GO-3.</p>
<h2>HOW TO USE IT</h2>
<p>Press SETUP to create the world of red and green patches. Then press GO-1 to see what effect it has. Now try GO-2. Is the result any different from GO-1? You can try both of them a few times to see if you notice anything.</p>
<p>After that press GO-3 to see what effect it has on the colors of the patches. Is that what you expected? Do you have any idea what the cause of this behavior is? Now try GO-4. Does it give the expected result? Do you understand why?</p>
<h2>THINGS TO NOTICE</h2>
<p>While playing around with the model, you should have seen that GO-3 gives very different results than GO-4: instead of swapping red and green patches like we intended, it turns all the patches green! Why is that?</p>
<p>This has to do with the timing of "side effects". In GO-3, we start by using the following code to ask all the red patches to turn green if there are at least 5 green patches:</p>
<pre><code>ask patches with [ pcolor = red ] [
  if count patches with [ pcolor = green ] &gt; 5 [
    set pcolor green
  ]
]
</code></pre>
<p>Then, we ask all the green patches to turn red if there are at least 5 red patches:</p>
<pre><code>ask patches with [ pcolor = green ] [
  if count patches with [ pcolor = red ] &gt; 5 [
    set pcolor red
  ]
]
</code></pre>
<p>But since we previously turned all red patches green, "<code>count patches with [ pcolor = red ]</code>" is now 0, so they all stay green!</p>
<p>What is it about GO-4 that prevents this from happening? It is the fact that we constructed our agentsets (<code>red-patches</code> and <code>green-patches</code>) <em>before</em> performing any changes on our patches. The <code>red-patches</code> agentset is insulated from the side effects of turning red patches to green, so when we run this code:</p>
<pre><code>ask green-patches [
  if count red-patches &gt; 5 [
    set pcolor red
  ]
]
</code></pre>
<p>...the original set of green patches turn red as expected.</p>
<h2>THINGS TO TRY</h2>
<p>Try running GO-1 and GO-2 a number of times. Which is faster? Sometimes, it can be hard to tell when you're just playing with a model "by hand". This why we wrote a reporter procedure called <code>test-1-2</code>. There is no button for this procedure on the interface, but you can invoke it from the command center. If you try it, you will see the patch labels flickering in the view for a while, and then, printed in the command center, the time it took to run GO-1 and GO-2 a hundred times each. Although GO-2 is somewhat faster than GO-1, the difference isn't extreme. Why is that?</p>
<p>As is common with a lot of NetLogo models, the bulk of the processing time is taken up by view updates: in this case, displaying all the patch labels on the screen. If you really want to measure the speed difference between two procedures, it is a good idea to turn off view updates by unchecking the corresponding checkbox in the NetLogo toolbar.</p>
<p>Try it. Which procedure is faster now?</p>
<p>Another thing that you can try is to increase the size of the world. Is the difference between GO-1 and GO-2 more noticeable when there are more patches?</p>
<h2>EXTENDING THE MODEL</h2>
<p>We have used the <code>reset-timer</code> and <code>timer</code> primitives to write a test function that compares the running times of G0-1 and GO-2, but NetLogo also has a built in <code>profiler</code> extension that serves the same purpose and gives you a lot more information about the  performance of your model.</p>
<p>You can read the documentation for the <code>profiler</code> extension online at <a href="http://ccl.northwestern.edu/netlogo/docs/profiler.html">http://ccl.northwestern.edu/netlogo/docs/profiler.html</a>.</p>
<p>Try to replace the <code>test-1-2</code> procedure with one that is adapted from the example in the documentation of the <code>profiler</code> extension. Can you replicate the results that you had with <code>test-1-2</code>?</p>
<h2>HOW TO CITE</h2>
<p>This model is part of the textbook, “Introduction to Agent-Based Modeling: Modeling Natural, Social and Engineered Complex Systems with NetLogo.”</p>
<p>If you mention this model or the NetLogo software in a publication, we ask that you include the citations below.</p>
<p>For the model itself:</p>
<ul>
<li>Rand, W., Wilensky, U. (2008).  NetLogo Agentset Efficiency model.  http://ccl.northwestern.edu/netlogo/models/AgentsetEfficiency.  Center for Connected Learning and Computer-Based Modeling, Northwestern Institute on Complex Systems, Northwestern University, Evanston, IL.</li>
</ul>
<p>Please cite the NetLogo software as:</p>
<ul>
<li>Wilensky, U. (1999). NetLogo. http://ccl.northwestern.edu/netlogo/. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.</li>
</ul>
<p>Please cite the textbook as:</p>
<ul>
<li>Wilensky, U. &amp; Rand, W. (2015). Introduction to Agent-Based Modeling: Modeling Natural, Social and Engineered Complex Systems with NetLogo. Cambridge, MA. MIT Press.</li>
</ul>
<h2>COPYRIGHT AND LICENSE</h2>
<p>Copyright 2008 Uri Wilensky.</p>
<p><img alt="CC BY-NC-SA 3.0" src="http://ccl.northwestern.edu/images/creativecommons/byncsa.png" /></p>
<p>This model is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 License.  To view a copy of this license, visit https://creativecommons.org/licenses/by-nc-sa/3.0/ or send a letter to Creative Commons, 559 Nathan Abbott Way, Stanford, California 94305, USA.</p>
<p>NetLogo itself is free software for non-commercial use under the terms of the GNU General Public License (<a href="https://ccl.northwestern.edu/netlogo/docs/copyright.html">see full license information here</a>).</p>
<p>To inquire about commercial licenses for either NetLogo or specific models from the models library, please contact netlogo-commercial-admin@ccl.northwestern.edu.</p>
<!-- 2008 Cite: Rand, W., Wilensky, U. --></div>
      </div>
    </main>
  </body>
</html>
